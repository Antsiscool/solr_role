<?xml version="1.0" encoding="UTF-8" ?>
<!-- Licensed to the Apache Software Foundation (ASF) under one or more contributor 
	license agreements. See the NOTICE file distributed with this work for additional 
	information regarding copyright ownership. The ASF licenses this file to 
	You under the Apache License, Version 2.0 (the "License"); you may not use 
	this file except in compliance with the License. You may obtain a copy of 
	the License at http://www.apache.org/licenses/LICENSE-2.0 Unless required 
	by applicable law or agreed to in writing, software distributed under the 
	License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS 
	OF ANY KIND, either express or implied. See the License for the specific 
	language governing permissions and limitations under the License. -->

<!-- For more details about configurations options that may appear in this 
	file, see http://wiki.apache.org/solr/SolrConfigXml. -->
	
<config>
	<luceneMatchVersion>${solr.lucene.version}</luceneMatchVersion>
	<dataDir>${solr.data.dir:}</dataDir>
	
	<directoryFactory name="DirectoryFactory" class="${solr.directoryFactory:solr.NRTCachingDirectoryFactory}">
		<!-- These will be used if you are using the solr.HdfsDirectoryFactory, 
			otherwise they will be ignored. If you don't plan on using hdfs, you can 
			safely remove this section. -->
		<!-- The root directory that collection data should be written to. -->
		<str name="solr.hdfs.home">${solr.hdfs.home:}</str>
		<!-- The hadoop configuration files to use for the hdfs client. -->
		<str name="solr.hdfs.confdir">${solr.hdfs.confdir:}</str>
		<!-- Enable/Disable the hdfs cache. -->
		<str name="solr.hdfs.blockcache.enabled">${solr.hdfs.blockcache.enabled:true}</str>
		<!-- Enable/Disable using one global cache for all SolrCores. The settings 
			used will be from the first HdfsDirectoryFactory created. -->
		<str name="solr.hdfs.blockcache.global">${solr.hdfs.blockcache.global:true}</str>
	</directoryFactory>
	
	<codecFactory class="solr.SchemaCodecFactory" />
	<schemaFactory class="ClassicIndexSchemaFactory" />
	
	<indexConfig>
		<maxIndexingThreads>16</maxIndexingThreads>
		<ramBufferSizeMB>100</ramBufferSizeMB>
		<maxBufferedDocs>1000</maxBufferedDocs>
		<mergeFactor>10</mergeFactor>
		<mergeScheduler class="org.apache.lucene.index.ConcurrentMergeScheduler" />
		<lockType>${solr.lock.type:native}</lockType>
		<infoStream>true</infoStream>
	</indexConfig>
	
	<jmx />
	
	<updateHandler class="solr.DirectUpdateHandler2">
		<autoSoftCommit>
			<maxTime>${solr.autoSoftCommit.maxTime:15000}</maxTime>
		</autoSoftCommit>
		<maxPendingDeletes>100</maxPendingDeletes>
	</updateHandler>
	
	<query>
		<maxBooleanClauses>10240</maxBooleanClauses>
		
		<filterCache 
			class="solr.FastLRUCache" 
			size="20480"
			initialSize="0" 
			autowarmCount="1024" />
			
		<queryResultCache 
			class="solr.FastLRUCache" 
			size="1024"
			initialSize="0" 
			autowarmCount="256" />
			
		<cache 
			name="perSegFilter" 
			class="solr.search.LRUCache" 
			size="10"
			initialSize="0" 
			autowarmCount="10" 
			egenerator="solr.NoOpRegenerator" />
			
		<fieldValueCache 
			class="solr.FastLRUCache" 
			size="1024"
			autowarmCount="128" 
			showItems="32" />
			
		<enableLazyFieldLoading>true</enableLazyFieldLoading>
		<useFilterForSortedQuery>true</useFilterForSortedQuery>
		<queryResultWindowSize>150</queryResultWindowSize>
		<queryResultMaxDocsCached>200</queryResultMaxDocsCached>
		<listener event="newSearcher" class="solr.QuerySenderListener" />
		<listener event="firstSearcher" class="solr.QuerySenderListener" />
		<useColdSearcher>false</useColdSearcher>
		<maxWarmingSearchers>4</maxWarmingSearchers>
		<slowQueryThresholdMillis>${solr.slow.query.threshold:200}</slowQueryThresholdMillis>
	</query>
	
	<requestDispatcher handleSelect="true">
		<requestParsers 
			enableRemoteStreaming="false"
			multipartUploadLimitInKB="2048000" 
			formdataUploadLimitInKB="2048"
			addHttpRequestToContext="true" />
		<httpCaching never304="true" />
	</requestDispatcher>
	
	<requestHandler name="/select" class="solr.SearchHandler"
		default="true">
		<lst name="defaults">
			<str name="echoParams">explicit</str>
			<str name="fl">*,score,[savedAdInfo]</str>
		</lst>
		<arr name="components">
			<str>savedAdsSearchComponent</str>
			<str>facet</str>
			<str>stats</str>
			<str>debug</str>
		</arr>
	</requestHandler>

	<xi:include href="replication/solrconfig-replication_master.xml" xmlns:xi="http://www.w3.org/2001/XInclude">
		<xi:fallback>
			<xi:include href="replication/solrconfig-replication_slave.xml">
				<xi:fallback>
					<xi:include href="replication/solrconfig-replication_repeater.xml" />
				</xi:fallback>
			</xi:include>
		</xi:fallback>
	</xi:include>
	
	<!-- legacy -->
<!-- 	<requestHandler name="/dismax" class="solr.SearchHandler" default="false"> -->
<!-- 		<lst name="defaults"> -->
<!-- 			<str name="wt">json</str> -->
<!-- 			<str name="indent">${solr.indent:on}</str> -->
<!-- 			<int name="rows">20</int> -->
<!-- 			<str name="defType">dismax</str> -->
<!-- 			<str name="echoParams">explicit</str> -->
<!-- 			<float name="tie">0.01</float> -->
<!-- 			<str name="debugQuery">false</str> -->
<!-- 			<str name="spellcheck">false</str> -->
	
<!-- 			<xi:include href="solrconfig_queryfields.xml" xmlns:xi="http://www.w3.org/2001/XInclude"> -->
<!-- 				<xi:fallback /> -->
<!-- 			</xi:include> -->
	
<!-- 			<str name="bf"></str> -->
<!-- 			<str name="fl">*,score,[savedAdInfo]</str> -->
<!-- 			<int name="ps">100</int> -->
<!-- 			<str name="q.alt">*:*</str> -->
<!-- 			<str name="hl.fl">*</str> -->
	
<!-- 		</lst> -->
<!-- 		<arr name="components"> -->
<!-- 			<str>savedAdsSearchComponent</str> -->
<!-- 			<str>facet</str> -->
<!-- 			<str>stats</str> -->
<!-- 			<str>debug</str> -->
<!-- 		</arr> -->
<!-- 	</requestHandler> -->

	<requestHandler name="/dismax" class="solr.SearchHandler" default="false">
		<lst name="defaults">
			<str name="wt">json</str>
			<str name="indent">${solr.indent:on}</str>
			<int name="rows">20</int>
			<str name="defType">dismax</str>
			<str name="echoParams">explicit</str>
			<float name="tie">0.01</float>
			<str name="debugQuery">false</str>
			<str name="spellcheck">false</str>
	
			<xi:include href="freetext-search/freetext-search_queryfields.xml" xmlns:xi="http://www.w3.org/2001/XInclude">
				<xi:fallback />
			</xi:include>
	
			<!--funcion para ordenarlos -->
			<str name="bf"></str>
			<str name="fl">*,score,[savedAdInfo]</str>
			<int name="ps">100</int>
			<str name="q.alt">*:*</str>
			<str name="hl.fl">*</str>
	
		</lst>
		<arr name="components">
			<str>savedAdsSearchComponent</str>
			<str>facet</str>
			<str>stats</str>
			<str>debug</str>
		</arr>
	</requestHandler>

	<!-- asÃ­ va a quedar -->
	<requestHandler name="/dismax2" class="solr.SearchHandler" default="false">
		<lst name="defaults">
			<str name="wt">json</str>
			<str name="indent">${solr.indent:on}</str>
			<int name="rows">20</int>
			<str name="defType">dismax</str>
			<str name="echoParams">explicit</str>
			<float name="tie">0.01</float>
			<str name="debugQuery">false</str>
			<str name="spellcheck">false</str>
			<str name="bf"></str>
			<str name="fl">*,score</str>
			<int name="ps">100</int>
			<str name="q.alt">*:*</str>
			<str name="hl.fl">*</str>
		</lst>
	</requestHandler>

	<!-- freetext config -->
	<xi:include href="freetext-search/freetext-search-solrconfig.xml" xmlns:xi="http://www.w3.org/2001/XInclude">
		<xi:fallback />
	</xi:include>

	<!-- professional search config -->
	<xi:include href="professional-search/professional-search-handler-config.xml" xmlns:xi="http://www.w3.org/2001/XInclude">
		<xi:fallback />
	</xi:include>

	<requestHandler name="partitioned" class="solr.SearchHandler">
		<lst name="defaults">
			<str name="defType">dismax</str>
			<str name="echoParams">explicit</str>
			<str name="qf">text^0.5 features^1.0 name^1.2 sku^1.5 id^10.0</str>
			<str name="mm">2&lt;-1 5&lt;-2 6&lt;90%</str>
			<str name="bq">incubationdate_dt:[* TO NOW/DAY-1MONTH]^2.2</str>
		</lst>
		<lst name="invariants">
			<str name="fl">*</str>
		</lst>
		<lst name="appends">
			<str name="fq">inStock:true</str>
		</lst>
		<lst name="invariants">
			<str name="facet.field">cat</str>
			<str name="facet.field">manu_exact</str>
			<str name="facet.query">price:[* TO 500]</str>
			<str name="facet.query">price:[500 TO *]</str>
		</lst>
	</requestHandler>

	<requestHandler name="spellchecker" class="solr.SpellCheckerRequestHandler" startup="lazy">
		<lst name="defaults">
			<int name="suggestionCount">1</int>
			<float name="accuracy">0.5</float>
		</lst>
		<str name="spellcheckerIndexDir">spell</str>
		<str name="termSourceField">word</str>
	</requestHandler>

	<requestHandler name="/mlt" class="solr.MoreLikeThisHandler">
		<lst name="defaults">
			<str name="mlt.fl">manu,cat</str>
			<int name="mlt.mindf">1</int>
		</lst>
	</requestHandler>

	<requestHandler name="/dataimport" class="org.apache.solr.handler.dataimport.DataImportHandler">
		<lst name="defaults">
			<str name="config">data-config.xml</str>
		</lst>
	</requestHandler>

	<requestHandler name="/search"
		class="org.apache.solr.handler.component.SearchHandler">
		<lst name="defaults">
			<str name="echoParams">explicit</str>
		</lst>
		<!-- By default, this will register the following components: <arr name="components"> 
			<str>query</str> <str>facet</str> <str>mlt</str> <str>highlight</str> <str>debug</str> 
			</arr> To insert handlers before or after the 'standard' components, use: 
			<arr name="first-components"> <str>first</str> </arr> <arr name="last-components"> 
			<str>last</str> </arr> -->
	</requestHandler>

	<!-- ping/healthcheck -->
	<requestHandler name="/admin/ping" class="solr.PingRequestHandler">
		<lst name="invariants">
			<str name="q">*:*</str>
			<str name="start">0</str>
			<str name="rows">0</str>
			<str name="fl">id</str>
		</lst>
		<lst name="defaults">
			<str name="echoParams">all</str>
		</lst>
		<!-- An optional feature of the PingRequestHandler is to configure the 
			handler with a "healthcheckFile" which can be used to enable/disable the 
			PingRequestHandler. relative paths are resolved against the data dir -->
		<!-- <str name="healthcheckFile">server-enabled.txt</str> -->
	</requestHandler>
	<requestHandler name="/analysis/field" startup="lazy"
		class="solr.FieldAnalysisRequestHandler" />
	<requestHandler name="/analysis/document"
		class="solr.DocumentAnalysisRequestHandler" startup="lazy" />

	<requestHandler name="/debug/dump" class="solr.DumpRequestHandler">
		<lst name="defaults">
			<str name="echoParams">explicit</str>
			<str name="echoHandler">true</str>
		</lst>
	</requestHandler>
	<!-- saved ad search config -->
	<requestHandler name="/saved" class="solr.SearchHandler">
		<arr name="components">
			<str>savedAdsSearchComponent</str>
			<str>facet</str>
			<str>stats</str>
			<str>debug</str>
		</arr>
		<lst name="defaults">
			<str name="wt">json</str>
			<str name="indent">${solr.indent:on}</str>
			<int name="rows">20</int>
			<str name="defType">edismax</str>
			<str name="echoParams">explicit</str>
			<float name="tie">0.01</float>
			<str name="debugQuery">false</str>
			<str name="spellcheck">false</str>
			<xi:include href="freetext-search/freetext-search_queryfields.xml" xmlns:xi="http://www.w3.org/2001/XInclude">
				<xi:fallback />
			</xi:include>
			<str name="pf"></str>
			<str name="bf"></str>
			<str name="fl">*,score,[savedAdInfo]</str>
			<int name="ps">100</int>
			<str name="q.alt">*:*</str>
			<str name="hl.fl">*</str>
		</lst>
	</requestHandler>

	<!-- Highlighting Component http://wiki.apache.org/solr/HighlightingParameters -->
	<searchComponent class="solr.HighlightComponent" name="highlight">
		<highlighting>
			<!-- Configure the standard fragmenter -->
			<!-- This could most likely be commented out in the "default" case -->
			<fragmenter name="gap" class="org.apache.solr.highlight.GapFragmenter"
				default="true">
				<lst name="defaults">
					<int name="hl.fragsize">100</int>
				</lst>
			</fragmenter>

			<!-- A regular-expression-based fragmenter (f.i., for sentence extraction) -->
			<fragmenter name="regex"
				class="org.apache.solr.highlight.RegexFragmenter">
				<lst name="defaults">
					<!-- slightly smaller fragsizes work better because of slop -->
					<int name="hl.fragsize">70</int>
					<!-- allow 50% slop on fragment sizes -->
					<float name="hl.regex.slop">0.5</float>
					<!-- a basic sentence pattern -->
					<str name="hl.regex.pattern">[-\w ,/\n\"']{20,200}</str>
				</lst>
			</fragmenter>

			<!-- Configure the standard formatter -->
			<formatter name="html" class="org.apache.solr.highlight.HtmlFormatter"
				default="true">
				<lst name="defaults">
					<str name="hl.simple.pre"><![CDATA[<em>]]></str>
					<str name="hl.simple.post"><![CDATA[</em>]]></str>
				</lst>
			</formatter>
		</highlighting>
	</searchComponent>

	<!-- saved ads search component -->
	<searchComponent 
		class="com.ilc.solr.components.SavedAdsSearchComponent"
		name="savedAdsSearchComponent" />
		
	<queryResponseWriter 
		name="json" 
		class="solr.JSONResponseWriter"
		default="true" />
		
	<transformer name="savedAdInfo" class="com.ilc.solr.transformers.SavedAdsTransformerFactory">
		<bool name="enabled">true</bool>
		<!-- <str name="savedadtypefieldname">savedAdType</str> -->
		<str name="savedadcommentfieldname">savedAdComment</str>
	</transformer>
	
	<queryParser name="savedAdsParser" class="com.ilc.solr.parsers.lucene.SavedAdsLuceneQParserPlugin" />
	<queryParser name="savedAdsDismaxParser" class="com.ilc.solr.parsers.dismax.SavedAdsDisMaxQParserPlugin" />
	
	<!-- professional search config -->
	<xi:include href="professional-search/professional-search-parser-config.xml" xmlns:xi="http://www.w3.org/2001/XInclude">
		<xi:fallback />
	</xi:include>
	
	<valueSourceParser name="after" class="com.ilc.solr.functions.AfterValueSourceParser" />
	<valueSourceParser name="customScore" class="com.ilc.solr.functions.CustomScoreValueSourceParser" />
	
	<!-- ads-pipeline config -->
	<xi:include href="pipeline/ads-pipeline.xml" xmlns:xi="http://www.w3.org/2001/XInclude">
		<xi:fallback />
	</xi:include>

	<!-- Legacy config for the admin interface -->
	<admin>
		<defaultQuery>*:*</defaultQuery>
	</admin>


</config>
